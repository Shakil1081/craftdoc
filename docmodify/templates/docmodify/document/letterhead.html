{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="{% static 'css/lh_setup_style.css' %}">
  <link rel="stylesheet" href="{% static 'css/lh_setup_custom.css' %}">

  {% for font in fonts %}
    <link rel="stylesheet" href="{{ font.url }}" />
  {% endfor %}

  <title>Letterhead</title>
</head>

<body>
  {% load custom_filters %}
  <div id="letterhead-body">
    <!-- Left Panel: Letterhead Items -->
    <div class="left-panel">
      <div class="row row-cols-2 g-2 letterhead-items">
        {% for singleDocument in documents %}
          {% with img=images_by_document|get_item:singleDocument.id %}
            <div class="letterhead-item {% if singleDocument.id == document.id %}selected{% endif %}" 
                 data-document-id="{{ singleDocument.id }}" 
                 data-header="{{ img.header }}" 
                 data-footer="{{ img.footer }}" 
                 data-phone="{{ singleDocument.phone|default:'' }}" 
                 data-email="{{ singleDocument.email|default:'' }}" 
                 data-location="{{ singleDocument.location|default:'' }}">
              <img class="preview-image" src="{{ singleDocument.file_path.url }}" alt="Template {{ forloop.counter }}" />
            </div>
          {% endwith %}
        {% endfor %}
      </div>
    </div>

    <div class="content-panel">
      <div class="zoom-buttons">
          <div class="input-group input-group-sm">
              <button id="zoomOutBtn" class="input-group-text">-</button>
              <div id="zoomInput" class="form-control  text-center">
                  100%
              </div>
              <button id="zoomInBtn" class="input-group-text">+</button>
          </div>
      </div>
      <div class="content">
          <div id="a4panel">
              <img id="logoShow" 
                  src="{{ document.logo_path.url }}" 
                  alt="Logo">
          
              <div id="phoneShow">
                  {% if document.phone %}
                      {{ document.phone|linebreaksbr }}
                  {% else %}
                      01736234377<br>01916120927
                  {% endif %}
              </div>
          
              <div id="emailShow">
                  {% if document.email %}
                      {{ document.email|linebreaksbr }}
                  {% else %}
                      admin@gmail.com<br>mail@example.com
                  {% endif %}
              </div>
          
              <div id="locationShow">
                  {% if document.location %}
                      {{ document.location|linebreaksbr }}
                  {% else %}
                      123, Main Street,<br>Dhaka, Bangladesh.
                  {% endif %}
              </div>
          </div>                
      </div>
  </div>

    <!-- Right Panel: Header/Footer Selection -->
    <div class="right-panel">
      <div class="mb-3 d-none">
          <button class="btn btn-primary" id="getCss">Get CSS</button>
          <button class="btn btn-success" id="saveCss">Save</button>
          {% if header_footer_images.count > 1 %}
              <button class="btn btn-warning" id="saveAllCss">Save All</button>
          {% endif %}
      </div>
      <div id="messageBox" class="alert d-none" role="alert"></div>
      <div class="d-flex align-items-center mb-3 gap-3">
          <h5 class="m-0">Download </h5>
          <div class="btn-group btn-group-sm">
              <button class="btn btn-outline-danger" id="downloadPdf">PDF</button>
              <button class="btn btn-outline-secondary" id="downloadPng">PNG</button>
              <button class="btn btn-outline-success" id="downloadJpg">JPG</button>
          </div>
      </div>
      <div class="logo-change-panel">
          <h5>Logo </h5>
          <div class="logo-panel">
              <img id="logoPreview" class="logo" src="{{ document.logo_path.url }}" alt="Logo Preview">
              <label for="logoInput" class="change-logo">Change</label>
          </div>
          <input type="file" hidden id="logoInput" class="form-control" accept="image/*">
          <div class="input-group input-group-sm mt-1 d-none">
              <input type="number" class="form-control" id="logoLeft" placeholder="Left">
              <input type="number" class="form-control" id="logoRight" placeholder="Right">
              <input type="number" class="form-control" id="logoTop" placeholder="Top">
              <input type="number" class="form-control" id="logoBottom" placeholder="Bottom">
          </div>
          <div class="input-group input-group-sm d-none">
              <span class="input-group-text">Width</span>
              <input type="number" class="form-control" id="logoWidthInput" placeholder="Width">
              <span class="input-group-text">Height</span>
              <input type="number" class="form-control" id="logoHeightInput" placeholder="Height">
          </div>

      </div>
      <hr>
      <div class="single-content-panel">
          <h5 class="title">Phone</h5>
          {% comment %} <textarea name="" rows="2" id="phoneInput" class="form-control form-control-sm"></textarea> {% endcomment %}
          <textarea name="" rows="2" id="phoneInput" class="form-control form-control-sm">{{ document.phone }}</textarea>

          <div class="input-group  input-group-sm d-none">
              <input type="number" class="form-control" id="phoneLeft" placeholder="Left">
              <input type="number" class="form-control" id="phoneRight" placeholder="Right">
              <input type="number" class="form-control" id="phoneTop" placeholder="Top">
              <input type="number" class="form-control" id="phoneBottom" placeholder="Bottom">
          </div>
          <div class="input-group input-group-sm d-none">
              <span class="input-group-text">
                  <i id="phoneLeftAlign" class="fa-solid fa-align-left align-icon"></i>
              </span>
              <span class="input-group-text">
                  <i id="phoneCenterAlign" class="fa-solid fa-align-center align-icon selected"></i>
              </span>
              <span class="input-group-text">
                  <i id="phoneRightAlign" class="fa-solid fa-align-right align-icon"></i>
              </span>
              <b class="input-group-text">
                  <span style="width: 16px;" id="phoneBoldInput">B</span>
              </b>
              <i class="input-group-text">
                  <span style="width: 16px;" id="phoneItalicInput">i</span>
              </i>
              <input type="color" class="form-control form-control-sm form-control-color" id="phoneColorInput">
          </div>
          <div class="input-group input-group-sm d-none">
              <select name="" id="phoneFontFamily" class="form-select form-select-sm">
                  <option value="">Font Family</option>
                  <option value='"Times New Roman", Times, serif'>Times New Roman</option>
                  <option value='"Courier New", Courier, monospace'>Courier New</option>
                  <option value='"Lucida Console", Monaco, monospace'>Lucida Console</option>
                  <option value='"Arial Black", Gadget, sans-serif'>Arial Black</option>
                  <option value='"Comic Sans MS", cursive, sans-serif'>Comic Sans MS</option>
                  <option value='"Georgia", serif'>Georgia</option>
                  <option value='"Impact", Charcoal, sans-serif'>Impact</option>
                  <option value='"Palatino Linotype", "Book Antiqua", Palatino, serif'>Palatino Linotype</option>
                  <option value='"Tahoma", Geneva, sans-serif'>Tahoma</option>
              </select>

              <input type="number" style="max-width: 80px;" class="form-control d-none" id="phoneFontSize"
                  placeholder="Size">
          </div>
      </div>

      <div class="single-content-panel">
          <h5 class="title">Email</h5>
          {% comment %} <textarea name="" id="emailInput" rows="2" class="form-control form-control-sm"></textarea> {% endcomment %}
          <textarea name="" id="emailInput" rows="2" class="form-control form-control-sm">{{ document.email }}</textarea>

          <div class="input-group input-group-sm d-none">
              <input type="number" class="form-control" id="emailLeft" placeholder="Left">
              <input type="number" class="form-control" id="emailRight" placeholder="Right">
              <input type="number" class="form-control" id="emailTop" placeholder="Top">
              <input type="number" class="form-control" id="emailBottom" placeholder="Bottom">
          </div>

          <div class="input-group input-group-sm d-none">
              <span class="input-group-text">
                  <i id="emailLeftAlign" class="fa-solid fa-align-left align-icon"></i>
              </span>
              <span class="input-group-text">
                  <i id="emailCenterAlign" class="fa-solid fa-align-center align-icon selected"></i>
              </span>
              <span class="input-group-text">
                  <i id="emailRightAlign" class="fa-solid fa-align-right align-icon"></i>
              </span>
              <b class="input-group-text">
                  <span style="width: 16px;" id="emailBoldInput">B</span>
              </b>
              <i class="input-group-text">
                  <span style="width: 16px;" id="emailItalicInput">i</span>
              </i>
              <input type="color" class="form-control form-control-sm form-control-color" id="emailColorInput">
          </div>

          <div class="input-group input-group-sm d-none">
              <select name="" id="emailFontFamily" class="form-select form-select-sm">
                  <option value="">Font Family</option>
                  <option value='"Times New Roman", Times, serif'>Times New Roman</option>
                  <option value='"Courier New", Courier, monospace'>Courier New</option>
                  <option value='"Lucida Console", Monaco, monospace'>Lucida Console</option>
                  <option value='"Arial Black", Gadget, sans-serif'>Arial Black</option>
                  <option value='"Comic Sans MS", cursive, sans-serif'>Comic Sans MS</option>
                  <option value='"Georgia", serif'>Georgia</option>
                  <option value='"Impact", Charcoal, sans-serif'>Impact</option>
                  <option value='"Palatino Linotype", "Book Antiqua", Palatino, serif'>Palatino Linotype</option>
                  <option value='"Tahoma", Geneva, sans-serif'>Tahoma</option>
              </select>

              <input type="number" style="max-width: 80px;" class="form-control d-none" id="emailFontSize"
                  placeholder="Size">
          </div>

      </div>

      <div class="single-content-panel">
          <h5 class="title">Location</h5>
          {% comment %} <textarea name="" id="locationInput" rows="2" class="form-control form-control-sm"></textarea> {% endcomment %}
          <textarea name="" id="locationInput" rows="2" class="form-control form-control-sm">{{ document.location }}</textarea>

          <div class="input-group input-group-sm d-none">
              <input type="number" class="form-control" id="locationLeft" placeholder="Left">
              <input type="number" class="form-control" id="locationRight" placeholder="Right">
              <input type="number" class="form-control" id="locationTop" placeholder="Top">
              <input type="number" class="form-control" id="locationBottom" placeholder="Bottom">
          </div>

          <div class="input-group input-group-sm d-none">
              <span class="input-group-text">
                  <i id="locationLeftAlign" class="fa-solid fa-align-left align-icon"></i>
              </span>
              <span class="input-group-text">
                  <i id="locationCenterAlign" class="fa-solid fa-align-center align-icon selected"></i>
              </span>
              <span class="input-group-text">
                  <i id="locationRightAlign" class="fa-solid fa-align-right align-icon"></i>
              </span>
              <b class="input-group-text">
                  <span style="width: 16px;" id="locationBoldInput">B</span>
              </b>
              <i class="input-group-text">
                  <span style="width: 16px;" id="locationItalicInput">i</span>
              </i>
              <input type="color" class="form-control form-control-sm form-control-color" id="locationColorInput">
          </div>

          <div class="input-group input-group-sm d-none">
              <select name="" id="locationFontFamily" class="form-select form-select-sm">
                  <option value="">Font Family</option>
                  {% for font in fonts %}
                      <option value="{{ font.font_family }}">{{ font.name }}</option>
                  {% empty %}
                      <option value='"Times New Roman", Times, serif'>Times New Roman</option>
                      <option value='"Courier New", Courier, monospace'>Courier New</option>
                      <option value='"Lucida Console", Monaco, monospace'>Lucida Console</option>
                      <option value='"Arial Black", Gadget, sans-serif'>Arial Black</option>
                      <option value='"Comic Sans MS", cursive, sans-serif'>Comic Sans MS</option>
                      <option value='"Georgia", serif'>Georgia</option>
                      <option value='"Impact", Charcoal, sans-serif'>Impact</option>
                      <option value='"Palatino Linotype", "Book Antiqua", Palatino, serif'>Palatino Linotype</option>
                      <option value='"Tahoma", Geneva, sans-serif'>Tahoma</option>
                  {% endfor %}
              </select>
              <input type="number" style="max-width: 80px;" class="form-control d-none" id="locationFontSize" placeholder="Size">
          </div>

      </div>

      <div class="single-content-panel header">
          <h5 class="title">Header</h5>
          <div id="headerChangePanel">
              {% for img in header_footer_images %}
                  {% if img.header %}
                  <div class="header-item {% if img.is_default %}selected{% endif %}" 
                       data-hf-id="{{ img.id }}" 
                       data-header="{{ img.header.url }}">
                      <img class="header-item-img" src="{{ img.header.url }}" alt="Header Image">
                  </div>
                  {% endif %}
              {% empty %}
                  <div class="header-item" data-hf-id="" data-header="">
                      <img class="header-item-img" src="" alt="No Header Available">
                  </div>
              {% endfor %}
          </div>
      </div>
      
      <div class="single-content-panel footer">
          <h5 class="title">Footer</h5>
          <div id="footerChangePanel">
              {% for img in header_footer_images %}
                  {% if img.footer %}
                  <div class="footer-item {% if img.is_default %}selected{% endif %}" 
                       data-hf-id="{{ img.id }}" 
                       data-footer="{{ img.footer.url }}">
                      <img class="footer-item-img" src="{{ img.footer.url }}" alt="Footer Image">
                  </div>
                  {% endif %}
              {% empty %}
                  <div class="footer-item" data-hf-id="" data-footer="">
                      <img class="footer-item-img" src="" alt="No Footer Available">
                  </div>
              {% endfor %}
          </div>
      </div>            
    </div>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/lh_custom.js' %}"></script>

  <!-- Inline JavaScript for AJAX Functionality -->
  <script>
    $(document).ready(function () {
      // Function to load header/footer data via AJAX
      function loadHeaderFooterData(documentId) {
        $.ajax({
          url: `/letterhead/${documentId}/`,
          type: 'GET',
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          },
          success: function (response) {
            const headerFooterImages = response.header_footer_images;

            // Clear existing header/footer panels
            $('#headerChangePanel').empty();
            $('#footerChangePanel').empty();

            // Populate header panel
            headerFooterImages.forEach(hf => {
              if (hf.header) {
                const isSelected = hf.is_default ? 'selected' : '';
                $('#headerChangePanel').append(`
                  <div class="header-item ${isSelected}" data-hf-id="${hf.id}" data-header="${hf.header}">
                    <img class="header-item-img" src="${hf.header}" alt="Header" />
                  </div>
                `);
              }
            });

            // Populate footer panel
            headerFooterImages.forEach(hf => {
              if (hf.footer) {
                const isSelected = hf.is_default ? 'selected' : '';
                $('#footerChangePanel').append(`
                  <div class="footer-item ${isSelected}" data-hf-id="${hf.id}" data-footer="${hf.footer}">
                    <img class="footer-item-img" src="${hf.footer}" alt="Footer" />
                  </div>
                `);
              }
            });
          },
          error: function (error) {
            console.error('Error fetching header/footer data:', error);
          }
        });
      }

      // Handle click on letterhead items
      $('.letterhead-item').on('click', function () {
        // Remove 'selected' class from all items
        $('.letterhead-item').removeClass('selected');
        $(this).addClass('selected');

        // Get the selected document ID
        const documentId = $(this).data('document-id');

        // Load header/footer data for the selected document
        loadHeaderFooterData(documentId);

        // Update the URL dynamically
        const newUrl = `/letterhead/${documentId}/`;
        window.history.pushState({}, '', newUrl);
      });

      // Trigger default selection
      const initialDocumentId = $('.letterhead-item').first().data('document-id');
      loadHeaderFooterData(initialDocumentId);
    });
  </script>
</body>
</html>